---
nav:
  title: 问题
  path: /intro
  order: 3
---

# 💓React Key

## React Key 使用

key 属性再列表渲染的时候起到关键作用

开发时我们偶尔会出现一个报错，显然是因为我们没有给列表项添加 key 值

<code src="./Code.tsx">列表</code>

![reactkey](./pic1.png 'reactkey')

常见的无效 Key 的情况：

- 使用数组索引
  如果列表的顺序变化（如排序、插入、删除等），索引 `key` 会导致 React 认为元素发生了变化，即使实际上没有变化。这会导致不必要的重新渲染、组件状态丢失、以及潜在的动画或输入框焦点等问题。
- 使用唯一不变 key
  多个元素的 key 相同，React 无法识别唯一标志，导致 diff 算法失效，渲染出错
- 缺少 key
  没有 `key` 属性时，React 无法高效地计算和匹配变化的列表项，导致潜在的性能问题和不正确的渲染行为。

## React Key 原理

React 给列表加 key 属性的原因，和我们熟悉的 diff 算法有关。

### key 的作用

对于同一层级的节点，React 会尝试通过比较 key 来优化更新。

- 如果两个节点有相同的 key，React 会认为它们是同一元素，并仅更新必要的属性，而不会完全重新渲染该节点。
- 如果没有 key 或者 key 不同，React 会将其视为不同的元素，从而删除旧的节点并添加新的节点。

### 性能优化

- 减少重排：
  使用 key 可以显著减少 DOM 操作的开销。例如，当列表中的某个元素移动时，带有 key 的元素可以被快速识别，React 只需移动该节点，而不需要重新渲染整个列表，这无疑大大提高了 React 性能和渲染效率。
- 维持组件状态：
  在某些情况下，key 可以帮助 React 保持组件的状态。例如，当列表中的某个组件被重新排序时，使用相同的 key 可以确保组件状态不会丢失。

更多详细的源码分析：https://jser.dev/react/2022/02/08/the-diffing-algorithm-for-array-in-react
